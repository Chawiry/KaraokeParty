{% extends "layout.html" %}

{% block body %}
<div class="container mt-4">
  <div class="text-center mb-4">
    <h2 class="display-5">Karaoke Queue</h2>
    <p class="text-muted">Add songs to the <b>QUEUE</b> below!</p>
  </div>

  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <form action="{{ url_for('add_to_queue') }}" method="post">
        <div class="form-group">
          <input type="text" name="song_name" autocomplete="off" required autofocus placeholder="Song Name" class="form-control form-control-lg">
        </div>
        <div class="form-group">
          <input type="text" name="song_artist" autocomplete="off" autofocus placeholder="Artist" class="form-control">
        </div>

        <div class="btn-group d-flex mb-3" data-toggle="buttons">
          <label class="btn btn-outline-secondary w-100">
            <input type="radio" name="vid_type" required autofocus value="Karaoke" checked> Karaoke
          </label>
          <label class="btn btn-outline-secondary w-100">
            <input type="radio" name="vid_type" required value="Lyrics"> Lyrics
          </label>
        </div>

        <div class="form-group">
          <label class="small font-weight-bold">Singers (comma-separated):</label>
          <textarea name="singers" rows="2" class="form-control" placeholder="Jose, Emilio..."></textarea>
        </div>

        <button type="submit" class="btn btn-success btn-block btn-lg shadow">Add to Queue</button>
      </form>
    </div>
  </div>

  <br>
  <h4 class="mb-0 text-center">Upcoming Songs</h4>
  <br>
  <div class="card">
    <ol class="list-group list-group-flush" id="songs_List"></ol>
  </div>

  <script>
    let songs = '{{ songs }}';
    let list = document.getElementById("songs_List");
    if(songs.trim() != '')
    {
      songs.split("*^%").forEach((song) => {    ///*^% is a separator to split without errors
        let li = document.createElement("li");
        let [id, name] = song.split("$%$%");
        li.className = "list-group-item d-flex justify-content-between align-items-center";

        li.innerHTML = `
                <div>
                    <span class="font-weight-bold">${name}</span>
                </div>
                <button class="btn btn-primary btn-sm rounded-pill" onclick="joinSong(${id})">
                    üéôÔ∏è Add Name
                </button>
            `;
        //li.textContent = name;
        //li.insertAdjacentHTML("beforeend", `<br><a class='btn btn-primary' onclick=joinSong(${id})  > TODO-CHANGE Click here To Join Song</a>`)
        list.appendChild(li);
      });
    }
    else
    {
      list.innerHTML = "<li class='list-group-item text-muted text-center'>No songs in queue yet.</li>";
      //li.innerText = "No Songs on QUEUE";
      //document.getElementById("songs_List").appendChild(li);
    }

    function joinSong(_song_id){
      let name = prompt("What is your Name?" + _song_id);
      if (!name) 
      {
        alert("Empty name, please enter a correct name!");
        return;
      }
      fetch('/add_singer', {
        method : "POST",
        headers : {'Content-Type' : 'application/json'},
        body : JSON.stringify({song_id: _song_id, new_singer: name})
      })
        .then(response => {
          if(!response.ok) alert("Somethings went wrong")
          return response.text();
        })
        .then(msg => {
          if (msg) alert(msg);
          window.location.href = '{{ url_for('queue') }}';
        });
    }
  </script>
  {% endblock %}
